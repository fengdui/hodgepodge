# 是指业务事务提交和发送消息同时成功或者失败的场景

* 先扔消息队列状态为待处理 如果发送成功 进行业务处理 否则退出业务 业务操作成功发送确认消息
* 存在的问题
  * 1.消息中间件存储成功或失败之后，消息中间件挂了应用不知道消息入库的结果
  * 2.返回应用结果超时，应用不知道消息入库的结果，如果成功，但是结果没有给应用，导致不一致，或者应用挂了，没来得及处理
  * 3.业务操作之后 发送处理结果失败
* 上述方案可以优化为消息中间件去询问业务 是否可以提交或者撤回消息 可以解决问题3 rocketmq的做法
* 可以在优化 业务不直接发送数据，先写入本地数据库，然后消息中间件轮训消息表 或者轮训的操作由业务方来做 轮询成功的然后发送消息